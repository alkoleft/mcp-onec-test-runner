# Известные проблемы 1C:EDT и способы их решения

## Проблема: EDT блокирует запуск Конфигуратора и подключение к ИБ

### Описание проблемы

**Симптомы:**
- ЕДТ блокирует возможность запуска Конфигуратора, даже если открыта другая рабочая область
- Подключенное приложение (ИБ) не удается подключить
- В логах выдается ошибка типа "база заблокирована" или "exclusive lock"

### Причина

Это известная проблема 1C:EDT версий до 2025.1, связанная с механизмом блокировки рабочих областей (workspace).
EDT создает блокировки на уровне файловой системы, которые могут конфликтовать с:
- Конфигуратором 1С:Предприятие
- Другими экземплярами EDT
- Подключениями к информационной базе

**Официальная ссылка:** [Issue #1758](https://github.com/1C-Company/1c-edt-issues/issues/1758)

### Решения

#### 1. Обновление до EDT 2025.1+

**Рекомендуется:** Обновите 1C:EDT до версии **2025.1 или выше**.

Эта версия содержит исправления механизма блокировок и работы с рабочими областями.

```yaml
# В application.yml
app:
  format: EDT
  tools:
    edt-cli:
      version: "2025.1"
```

#### 2. Использование отдельных рабочих областей

Используйте разные рабочие области (workspace) для:
- Работы в EDT GUI
- Автоматизации через EDT CLI (METR)
- Каждого отдельного проекта

```yaml
# Пример настройки отдельной рабочей области для METR
app:
  tools:
    edt-cli:
      working-directory: "/path/to/metr-workspace"
```

**Важно:** Убедитесь, что путь к workspace в конфигурации METR отличается от того, что используется в EDT GUI.

#### 3. Закрытие EDT перед запуском METR

Если вы используете EDT версии до 2025.1:

1. **Полностью закройте IDE EDT** перед запуском тестов через METR
2. Проверьте, что процесс EDT завершен

#### 4. Отключение интерактивного режима EDT CLI

Если проблемы с блокировками сохраняются, попробуйте отключить интерактивный режим:

```yaml
app:
  tools:
    edt-cli:
      interactive-mode: false
      auto-start: false
```

**Примечание:** Это замедлит конвертацию из EDT формата.

#### 5. Проверка и очистка lock-файлов

EDT создает lock-файлы в рабочей области. Если EDT завершился некорректно, эти файлы могут остаться и блокировать последующие запуски.

**Внимание:** Удаляйте lock-файлы только при полностью закрытом EDT!

### Диагностика проблемы

#### Проверка состояния EDT CLI в METR

METR предоставляет информацию о состоянии EDT CLI через логи.

Ожидаемые сообщения при успешном запуске:
- Процесс 1C:EDT CLI запущен с PID
- 1C:EDT CLI процесс успешно запущен и инициализирован
- 1C:EDT CLI процесс работает нормально

Признаки проблем:
- Исполняемый файл 1C:EDT CLI не найден
- Ошибка инициализации 1C:EDT CLI процесса
- 1C:EDT CLI процесс не отвечает

#### Проверка конфигурации

Убедитесь, что конфигурация корректна:

```yaml
app:
  format: EDT
  tools:
    edt-cli:
      version: "2025.1"
      working-directory: "/abs/path/to/dedicated/workspace"
```

### Рекомендации по настройке

#### Оптимальная конфигурация для EDT проектов

```yaml
app:
  id: my-project
  format: EDT
  base-path: "/path/to/project"
  
  tools:
    builder: DESIGNER
    edt-cli:
      auto-start: true
      version: "2025.1"
      interactive-mode: true
      working-directory: "/path/to/metr-edt-workspace"
      startup-timeout-ms: 60000
      command-timeout-ms: 300000
      ready-check-timeout-ms: 10000
```

#### Workflow для избежания конфликтов

1. **Для локальной разработки:**
   - Работайте в EDT GUI с основной рабочей областью
   - Настройте METR с отдельной рабочей областью
   - EDT GUI и METR могут работать одновременно

2. **Для CI/CD:**
   - Используйте чистую рабочую область для каждого запуска
   - Отключите интерактивный режим если нужна изоляция
   - Очищайте workspace после выполнения

### Часто задаваемые вопросы

**Q: Можно ли использовать METR с EDT версии 2024.x?**

A: Можно, но не рекомендуется. Версии до 2025.1 имеют проблемы с блокировками. Используйте обходные решения (отдельные workspace, отключение interactive-mode).

**Q: Нужно ли закрывать EDT перед запуском тестов через METR?**

A: При EDT 2025.1+ и правильной настройке (отдельные workspace) - нет. При более ранних версиях - желательно закрывать EDT GUI.

**Q: Что делать если METR не может подключиться к ИБ?**

A: 
1. Проверьте, что ИБ не заблокирована другим процессом
2. Убедитесь, что строка подключения корректна
3. Проверьте права доступа к файлам ИБ (для файловой базы)
4. Проверьте доступность сервера (для серверной базы)

**Q: Как понять, что проблема именно в EDT, а не в ИБ?**

A: Попробуйте подключиться к ИБ через обычный Конфигуратор без EDT. Если Конфигуратор подключается - проблема в EDT. Если нет - проблема в самой ИБ.

### Дополнительные ресурсы

- [Issue #1758 на GitHub](https://github.com/1C-Company/1c-edt-issues/issues/1758)
- [Документация METR по настройке](APPLICATION_CONFIGURATION.md)
- [Документация EDT CLI](https://releases.1c.ru/project/DevelopmentTools10)