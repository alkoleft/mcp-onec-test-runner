<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ This file is part of METR.
  ~
  ~ Copyright (C) 2025 Aleksey Koryakin <alkoleft@gmail.com> and contributors.
  ~
  ~ SPDX-License-Identifier: GPL-3.0-or-later
  ~
  ~ METR is free software: you can redistribute it and/or modify it under the
  ~ terms of the GNU General Public License as published by the Free Software
  ~ Foundation, either version 3 of the License, or (at your option) any later
  ~ version.
  ~
  ~ METR is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
  ~ See the GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with METR.  If not, see <https://www.gnu.org/licenses/>.
  -->

<configuration>

    <!-- Свойство для имени файла лога -->
    <property name="LOG_FILE" value="${LOG_FILE:-mcp-server.log}"/>

    <!-- Аппендер для записи в файл -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_FILE}</file>
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} %-5level - %msg%n</pattern>
        </encoder>

        <!-- Ротация файлов -->
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${LOG_FILE}.%d{yyyy-MM-dd}.%i.gz</fileNamePattern>
            <maxFileSize>10MB</maxFileSize>
            <maxHistory>5</maxHistory>
            <totalSizeCap>50MB</totalSizeCap>
        </rollingPolicy>
    </appender>

    <!-- ВАЖНО: НЕ логируем в консоль для MCP режима -->
    <!-- stdout используется для JSON-RPC протокола -->

    <!-- Логгеры -->
    <!-- ПРИМЕЧАНИЕ: Уровни логгирования могут переопределяться из application.yml или профилей -->
    <logger name="io.github.alkoleft" level="DEBUG"/>
    <logger name="org.springframework.ai.mcp" level="DEBUG"/>
    <logger name="org.springframework.boot" level="WARN"/>
    <logger name="org.springframework.cache" level="INFO"/>

    <!-- ROOT логгер - только файл -->
    <root level="DEBUG">
        <appender-ref ref="FILE"/>
    </root>

</configuration> 